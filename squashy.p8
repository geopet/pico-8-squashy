pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- squashy tutorial
-- by geopet (geoff petrie)

function _init()
  -- paddle
  pad={}
  pad.x=52
  pad.y=122
  pad.w=24
  pad.h=4

  -- ball
  ball={}
  ball.x=64
  ball.y=64
  ball.size=3
  ball.dx=5
  ball.dy=-3

  game={}
  game.score=0
  game.lives=3
  game.over=false
end

function _update()
  if (not game.over) then
    move_paddle()
    bounce_ball()
    bounce_paddle()
    move_ball()
    lose_deadball()
  else
    game_over()
  end
end

function _draw()
  -- clear the screen
  rectfill(0,0,128,128,3)

  -- draw the lives
  for i=1,game.lives do
    spr(4,90+i*8,4)
  end

  -- draw the score
  print(game.score,12,6,15)
  if (game.over) then
    print("game over",12,12,15)
  end

  -- draw the paddle
  rectfill(pad.x,pad.y,pad.x+pad.w,pad.y+pad.h,15)

  -- draw the ball
  circfill(ball.x,ball.y,ball.size,15)
end

function move_paddle()
  if btn(0) then
    pad.x-=3
  elseif btn(1) then
    pad.x+=3
  end
end

function move_ball()
  ball.x+=ball.dx
  ball.y+=ball.dy
end

function lose_deadball()
  if ball.y>128-ball.size then
    -- next life
    sfx(3)
    ball.y=24
    game.lives-=1

    if game.lives==0 then
      game.over=true
    end
  end
end

function bounce_ball()
  -- left
  if ball.x<ball.size then
    ball.dx=-ball.dx
    sfx(0)
  end

  -- right
  if ball.x>128-ball.size then
    ball.dx=-ball.dx
    sfx(0)
  end

  -- top
  if ball.y<ball.size then
    ball.dy=-ball.dy
    sfx(0)
  end
end

function bounce_paddle()
  if ball.x>=pad.x and ball.x<=pad.x+pad.w and ball.y>pad.y then
    sfx(1)
    -- increase score on hit
    game.score+=10
    ball.dy=-ball.dy
  end
end

function game_over()
  ball.dy=0
  ball.dx=0
  ball.y=64
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000088088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000088888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00090000185551f555205551d55500500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500
011000000f5530c500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001305513055130550f0500f0500f0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
